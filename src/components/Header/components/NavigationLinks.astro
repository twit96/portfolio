---
import { getCollection } from 'astro:content';

// Get Category Links
const publishedPosts = (await getCollection('posts')).filter(post => !post.data.draft && !post.data.archived);
const allCategories = publishedPosts.map((post) => post.data.category).flat().sort();
const uniqueCategories = [...new Set(allCategories)];
const categoryLinks = uniqueCategories.map(
  (category => {
    return {
      'text': category,
      'href': `/${category.toLowerCase()}/`
    }
  }
  )
);


// Define Main Navigation Links
let links = [
  { 'text': "Home", 'href': "/", },
  ...categoryLinks,
  { 'text': "Tags", 'href': "/tags/", }
];

// add accessibility attributes
links.forEach((link) => {
  link['aria-current'] = Astro.url.pathname===link.href ? "page" : "false";
});
---

<ul class="btns">
  {links.map(({text, ...attrs}) =>
    <li>
      <a {...attrs} class="btn surface2 underline-on-hover">
        {text}
      </a>
    </li>
  )}
</ul>

<style>
  .btns {
    flex-direction: column;
    width: 100%;
  }
  a {
    display: block;
    text-align: center;
    color: var(--text1);
  }
  a[aria-current="page"] { text-decoration: underline; }

  @media (min-width: 80ch) {
    .btns { flex-direction: row; }
  }
</style>
